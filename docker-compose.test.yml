services:
  service_test:
    build:
      context: ./service/
      dockerfile: Dockerfile.test
      args:
        HOST_UID: ${HOST_UID:-1000}
        HOST_GID: ${HOST_GID:-1000}
        HOST_USERNAME: ${HOST_USERNAME:-user}
        HOST_GROUPNAME: ${HOST_GROUPNAME:-group}
    environment:
      - JUPYTER_PLATFORM_DIRS=1
    ports:
      - 8888:8888
    tty: false
    restart: no
    image: local/service-test:ci
    command: pytest -q --cov=/app --cov-report=xml:/reports/ci/coverage.xml
    volumes:
      - /tmp/.X11-unix:/tmp/.X11-unix
      - ./service/app:/app
      - ./service/data:/data
      - ./service/root/jupyter:/root/.jupyter
      - ./reports:/app/reports
